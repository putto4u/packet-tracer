## μ 19μ¥: μΈν„°λ„· κ²μ΄νΈμ›¨μ΄μ™€ λ‚΄λ¶€λ§ κ³„μΈµ κµ¬μ΅° κµ¬μ„± μ‹¤λ¬΄

λ³Έ μ¥μ—μ„λ” μΈν„°λ„·(μ™Έλ¶€λ§)λ¶€ν„° μµν•λ‹¨ PCκΉμ§€ μ΄μ–΄μ§€λ” μ „ν•μ μΈ κΈ°μ—…μ© λ„¤νΈμ›ν¬μ μμ§μ  κµ¬μ΅°λ¥Ό μ„¤κ³„ν•κ³ , κ° μ¥λΉ„κ°€ μ™Έλ¶€μ™€ ν†µμ‹ ν•κΈ° μ„ν•΄ ν•„μ”ν• ν•µμ‹¬ μ„¤μ •(NAT, Static Route, Access Port)μ„ λ‹¤λ£Ήλ‹λ‹¤.

---

### 1. λ„¤νΈμ›ν¬ μ£Όμ† μ„¤κ³„ (IP Plan)

* **μΈν„°λ„· ISP κµ¬κ°„:** κ³µμΈ IP λ€μ—­ (μ: `211.1.1.0/30`)
* **λΌμ°ν„° β†” L3 μ¤μ„μΉ:** μ¥λΉ„ κ°„ μ—°κ²° λ€μ—­ (`172.16.1.0/30`)
* **λ‚΄λ¶€λ§(VLAN 10):** μ‚¬λ¬΄μ© PC λ€μ—­ (`10.10.10.0/24`)

---

### 2. μ¥λΉ„λ³„ μ„Έλ¶€ CLI μ„¤μ •

#### β‘  λΌμ°ν„° (Border Router)

μΈν„°λ„· κ²½κ³„ μ¥λΉ„λ΅, λ‚΄λ¶€ μ‚¬μ„¤ IPλ¥Ό κ³µμΈ IPλ΅ λ³€ν™ν•λ” **NAT(Network Address Translation)**μ™€ μ™Έλ¶€λ΅ λ‚κ°€λ” **κΈ°λ³Έ κ²½λ΅(Default Route)** μ„¤μ •μ΄ ν•µμ‹¬μ…λ‹λ‹¤.

```ios
hostname Router
!
interface GigabitEthernet0/0
 ip address 211.1.1.2 255.255.255.252    # ISP μ—°κ²° (Outside)
 ip nat outside
!
interface GigabitEthernet0/1
 ip address 172.16.1.1 255.255.255.252    # L3 μ¤μ„μΉ μ—°κ²° (Inside)
 ip nat inside
!
# NAT μ„¤μ •: λ‚΄λ¶€λ§(10.10.10.0)μ΄ μ™Έλ¶€λ΅ λ‚κ° λ• κ³µμΈ IP μ‚¬μ© ν—μ©
access-list 1 permit 10.10.10.0 0.0.0.255
ip nat inside source list 1 interface GigabitEthernet0/0 overload
!
# λΌμ°ν…: μ™Έλ¶€(μΈν„°λ„·)λ΅ λ‚κ°€λ” κ²½λ΅μ™€ λ‚΄λ¶€λ§μΌλ΅ λ“¤μ–΄μ¤λ” κ²½λ΅ μ§€μ •
ip route 0.0.0.0 0.0.0.0 211.1.1.1        # ISP λ°©ν–¥
ip route 10.10.10.0 255.255.255.0 172.16.1.2  # λ‚΄λ¶€λ§ λ°©ν–¥

```

---

#### β‘΅ L3 μ¤μ„μΉ (Distribution/Core)

λ‚΄λ¶€λ§μ κ²μ΄νΈμ›¨μ΄(SVI) μ—­ν• μ„ μν–‰ν•λ©°, λ¨λ“  νΈλν”½μ„ μƒμ„ λΌμ°ν„°λ΅ μ „λ‹¬ν•©λ‹λ‹¤.

```ios
hostname L3-Switch
!
ip routing
!
vlan 10
 name Office
!
interface GigabitEthernet0/1
 no switchport
 ip address 172.16.1.2 255.255.255.252    # λΌμ°ν„° μ—°κ²°
!
interface Vlan10
 ip address 10.10.10.1 255.255.255.0      # PCμ κ²μ΄νΈμ›¨μ΄
!
interface GigabitEthernet0/2
 switchport mode access
 switchport access vlan 10                # PC μ—°κ²° ν¬νΈ
!
# λ¨λ“  μ™Έλ¶€ νΈλν”½μ„ λΌμ°ν„°λ΅ μ „λ‹¬
ip route 0.0.0.0 0.0.0.0 172.16.1.1

```

---

#### β‘Ά PC (End Device)

μ‚¬μ©μ λ‹¨λ§κΈ°μ—μ„λ” μλ™ νΉμ€ DHCPλ¥Ό ν†µν•΄ IPλ¥Ό μ„¤μ •ν•©λ‹λ‹¤.

* **IP μ£Όμ†:** `10.10.10.10`
* **μ„λΈλ„· λ§μ¤ν¬:** `255.255.255.0`
* **κΈ°λ³Έ κ²μ΄νΈμ›¨μ΄:** `10.10.10.1` (L3 μ¤μ„μΉμ VLAN 10 IP)
* **DNS μ„λ²„:** `8.8.8.8` (Google DNS λ“±)

---

### 3. μ‹¤λ¬΄ κ²€μ¦ ν¬μΈνΈ

1. **λ‚΄λ¶€ ν†µμ‹  ν™•μΈ:** PCμ—μ„ L3 μ¤μ„μΉ κ²μ΄νΈμ›¨μ΄(`10.10.10.1`)λ΅ ν•‘ ν…μ¤νΈ.
2. **κ²½κ³„ ν†µμ‹  ν™•μΈ:** PCμ—μ„ λΌμ°ν„° λ‚΄λ¶€ IP(`172.16.1.1`)λ΅ ν•‘ ν…μ¤νΈ.
3. **μ™Έλ¶€ ν†µμ‹  ν™•μΈ:** PCμ—μ„ μΈν„°λ„· κ³µμΈ IP νΉμ€ DNS(`8.8.8.8`)λ΅ ν•‘ ν…μ¤νΈ.
4. **NAT ν™•μΈ:** λΌμ°ν„°μ—μ„ `show ip nat translations` λ…λ Ήμ„ ν†µν•΄ μ‚¬μ„¤ IPκ°€ κ³µμΈ IPλ΅ λ³€ν™λμ–΄ μ°νλ”μ§€ ν™•μΈ.

---
μ”μ²­ν•μ‹  λ‚΄μ©μ„ λ°”νƒ•μΌλ΅ κΉƒν—λΈ(Markdown)μ— λ°”λ΅ μ μ© κ°€λ¥ν• κ°•μ κµμ¬ ν•μ‹μΌλ΅ μ‘μ„±ν•μ€μµλ‹λ‹¤.

---

## PAT(Port Address Translation)μ μ΄ν•΄μ™€ μ„¤μ •

λ„¤νΈμ›ν¬ μ£Όμ† λ³€ν™(NAT) κΈ°μ  μ¤‘ κ°€μ¥ λ„λ¦¬ μ“°μ΄λ” λ°©μ‹μ€ **PAT(Port Address Translation)**μ…λ‹λ‹¤. μ‹μ¤μ½” λ…λ Ήμ–΄λ΅ `overload` μµμ…μ„ μ‚¬μ©ν•λ” μ΄ κΈ°μ μ€ ν•λ‚μ κ³µμΈ IP μ£Όμ†λ¥Ό μ—¬λ¬ λ€μ λ‚΄λ¶€ νΈμ¤νΈκ°€ κ³µμ ν•  μ μκ² ν•΄μ¤λ‹λ‹¤.

### 1. λ…λ Ήμ–΄μ κµ¬μ΅° λ¶„μ„

`ip nat inside source list 1 interface GigabitEthernet0/0 overload`

μ΄ ν• μ¤„μ λ…λ Ήμ–΄μ—λ” λ‹¤μκ³Ό κ°™μ€ ν•µμ‹¬ μ”μ†λ“¤μ΄ ν¬ν•¨λμ–΄ μμµλ‹λ‹¤.

* **`ip nat inside`**: λ‚΄λ¶€(Inside) λ„¤νΈμ›ν¬μ—μ„ μ™Έλ¶€(Outside)λ΅ λ‚κ°€λ” ν¨ν‚·μ„ λ³€ν™ λ€μƒμΌλ΅ μ§€μ •ν•©λ‹λ‹¤.
* **`source list 1`**: λ³€ν™ν•  λ€μƒ(Source)μ„ **ACL(Access Control List) 1λ²**μ— μ •μλ νΈμ¤νΈλ“¤λ΅ μ ν•ν•©λ‹λ‹¤.
* **`interface GigabitEthernet0/0`**: λ‚΄λ¶€ μ‚¬μ„¤ IPκ°€ λ³€ν™λμ–΄ λ‚κ° λ• μ‚¬μ©ν•  **κ³µμΈ IP μ£Όμ†**κ°€ ν• λ‹Ήλ μΈν„°νμ΄μ¤λ¥Ό μ§€μ •ν•©λ‹λ‹¤.
* **`overload`**: ν•µμ‹¬ ν‚¤μ›λ“μ…λ‹λ‹¤. μ—¬λ¬ λ‚΄λ¶€ IPκ°€ ν•λ‚μ κ³µμΈ IPλ¥Ό μ‚¬μ©ν•  λ•, **Port λ²νΈ**λ¥Ό μ΄μ©ν•΄ κ°κ°μ μ„Έμ…μ„ κµ¬λ¶„(PAT)ν•λ„λ΅ μ„¤μ •ν•©λ‹λ‹¤.

---

### 2. μ‘λ™ μ›λ¦¬: Portλ¥Ό μ΄μ©ν• λ‹¤μ¤‘ν™”

μΌλ°μ μΈ Dynamic NATλ” κ³µμΈ IP ν’€(Pool)μ— μλ” μ£Όμ†μ™€ λ‚΄λ¶€ IPλ¥Ό 1:1λ΅ λ§¤ν•‘ν•©λ‹λ‹¤. ν•μ§€λ§ `overload`λ¥Ό μ‚¬μ©ν•λ©΄ λ‹¤μκ³Ό κ°™μ΄ λ™μ‘ν•©λ‹λ‹¤.

| λ‚΄λ¶€ νΈμ¤νΈ (Source IP) | λ‚΄λ¶€ ν¬νΈ | λ³€ν™λ κ³µμΈ IP (Gi0/0) | λ³€ν™λ ν¬νΈ | λ©μ μ§€ (Destination) |
| --- | --- | --- | --- | --- |
| 192.168.10.10 | 1500 | 203.0.113.1 | **1500** | Google (80) |
| 192.168.10.11 | 1500 | 203.0.113.1 | **1501** | Naver (80) |

> **π’΅ ν•µμ‹¬ ν¬μΈνΈ**: λ‚΄λ¶€ ν¬νΈ λ²νΈκ°€ μ¤‘λ³µλλ”λΌλ„ NAT ν…μ΄λΈ”μ—μ„ μ™Έλ¶€λ΅ λ‚κ°€λ” ν¬νΈ λ²νΈλ¥Ό μ„μλ΅ λ³€κ²½ν•μ—¬ κ΄€λ¦¬ν•λ―€λ΅, ν•λ‚μ κ³µμΈ IPλ΅ μμ² κ°μ μ»¤λ„¥μ…μ„ μ²λ¦¬ν•  μ μμµλ‹λ‹¤.

---

### 3. μ‹¤μ „ μ„¤μ • λ‹¨κ³„ (Full Config)

PATλ¥Ό μ™„λ²½ν•κ² κµ¬λ™ν•κΈ° μ„ν•΄μ„λ” μΈν„°νμ΄μ¤ λ°©ν–¥ μ„¤μ •κ³Ό ACL μ •μκ°€ λ°λ“μ‹ μ„ ν–‰λμ–΄μ•Ό ν•©λ‹λ‹¤.

```bash
! 1. λ³€ν™ λ€μƒ μ •μ (Inside Local μ£Όμ† λ²”μ„)
access-list 1 permit 192.168.10.0 0.0.0.255

! 2. μ™Έλ¶€ μΈν„°νμ΄μ¤ μ§€μ • λ° PAT ν™μ„±ν™”
ip nat inside source list 1 interface GigabitEthernet0/0 overload

! 3. κ° μΈν„°νμ΄μ¤μ— NAT λ°©ν–¥ μ μ©
interface GigabitEthernet0/1
 description LAN_Inside
 ip address 192.168.10.1 255.255.255.0
 ip nat inside

interface GigabitEthernet0/0
 description WAN_Outside
 ip address 203.0.113.1 255.255.255.252
 ip nat outside

```

---

### 4. μμ£Ό μ‹¤μν•λ” λ¶€λ¶„ (Troubleshooting)

* **`ip nat inside/outside` λ„λ½**: λ…λ Ήμ–΄λ§ μ…λ ¥ν•κ³  μΈν„°νμ΄μ¤μ— λ°©ν–¥μ„ μ§€μ •ν•μ§€ μ•μΌλ©΄ λ³€ν™μ΄ μΌμ–΄λ‚μ§€ μ•μµλ‹λ‹¤.
* **ACL λ²”μ„ μ„¤μ • μ¤λ¥**: `permit` λμ§€ μ•μ€ IPλ” NAT μ„λΉ„μ¤μ—μ„ μ μ™Έλμ–΄ μΈν„°λ„· ν†µμ‹ μ΄ λ¶κ°€λ¥ν•΄μ§‘λ‹λ‹¤.
* **λΌμ°ν… κ²½λ΅ λ―Έν™•λ³΄**: NAT μ„¤μ •κ³Ό λ³„κ°λ΅ λ””ν΄νΈ λΌμ°νΈ(`ip route 0.0.0.0 0.0.0.0 ...`)κ°€ μ™Έλ¶€ μΈν„°νμ΄μ¤λ¥Ό ν–¥ν•κ³  μμ–΄μ•Ό ν•©λ‹λ‹¤.

---

### 5. μƒνƒ ν™•μΈ λ° κ²€μ¦

μ„¤μ • ν›„μ—λ” λ‹¤μ λ…λ Ήμ–΄λ“¤μ„ ν†µν•΄ NAT ν…μ΄λΈ”μ΄ μ •μƒμ μΌλ΅ μƒμ„±λλ”μ§€ ν™•μΈν•΄μ•Ό ν•©λ‹λ‹¤.

* `show ip nat translations`: ν„μ¬ λ³€ν™λμ–΄ κ΄€λ¦¬λκ³  μλ” NAT ν…μ΄λΈ” μ „μ²΄λ¥Ό ν™•μΈν•©λ‹λ‹¤.
* `show ip nat statistics`: NAT μ„±κ³µ νμ, μ¤λ¥, μ μ  μ¤‘μΈ IP μ •λ³΄λ¥Ό μ”μ•½ν•΄μ„ λ³΄μ—¬μ¤λ‹λ‹¤.
* `clear ip nat translation *`: ν…μ¤νΈλ¥Ό μ„ν•΄ κΈ°μ΅΄ NAT ν…μ΄λΈ” κ°•μ  μ΄κΈ°ν™” μ‹ μ‚¬μ©ν•©λ‹λ‹¤.

---

Next Level : NAT Pool vs Interface Overload μ°¨μ΄μ 

---

μ„¤μ • μ¤€μ ν™•μΈ: κΉƒν—λΈ λ§ν¬λ‹¤μ΄ ν¬λ§· μ μ©, 'Next Level' ν‘κΈ° μ™„λ£, κ°•μ‚¬/ν•™μ› λ“± κΈμ§€μ–΄ μ μ™Έ, λ‹¨λ‹µν• ν•µμ‹¬ λ‹¨μ–΄ λ§λ¬΄λ¦¬.

NAT Table, ACL, Port Multiplexing, Inside/Outside, Translation Entry

