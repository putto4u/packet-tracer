# Chapter 7. Network Optimization & Future Strategy (Advanced Operations)

## 1. 프로젝트 개요 (Project Overview)

### 1.1 프로젝트 명

**차세대 엔터프라이즈 네트워크 고도화 및 최적화 전략 수립**

### 1.2 배경 및 목적

초기 구축된 인프라의 안정성을 넘어, 운영 효율성을 극대화하고 미래 기술(Cloud, IPv6) 수용을 위한 기반을 마련합니다. 단순한 연결을 넘어 **품질 보장(QoS)**, **운영 자동화**, **지능형 장애 감지**를 통해 비즈니스 연속성을 강화하는 것을 목적으로 합니다.

### 1.3 핵심 추진 과제

1. **IP 정책 최적화:** 라우팅 테이블 최소화를 위한 경로 요약(Route Summarization).
2. **속도 및 품질 개선:** 중요 트래픽(VoIP, 화상회의, ERP) 우선 처리를 위한 QoS(Quality of Service) 적용.
3. **장애 대비(Safety):** 단순 링크 Down이 아닌, 논리적 장애 감지를 위한 IP SLA 및 트래킹 기술 도입.
4. **미래 전략:** IPv6 전환 대비를 위한 Dual Stack 구성 및 네트워크 자동화 준비.

---

## 2. IP 정책 개선: OSPF 경로 요약 (Route Summarization)

지사나 부서가 늘어날수록 라우팅 테이블이 비대해져 장비 부하가 증가하고 속도가 저하됩니다. 이를 방지하기 위해 **Inter-Area Route Summarization**을 적용합니다.

**[적용 시나리오]**
본사 내부망(`192.168.x.x`)의 수많은 상세 경로를 엣지 라우터(R1, R2)가 외부나 다른 Area로 전파할 때, 하나의 큰 대역으로 묶어서 전파하여 라우팅 성능을 향상시킵니다.

### 2.1 HQ Core (MSW1, MSW2) 설정

MSW는 내부 VLAN 대역(`192.168.10.0` ~ `192.168.50.0`)을 관리하므로, 이를 상단 라우터로 보낼 때 요약할 수 있습니다. (단, Packet Tracer의 L3 스위치 OSPF 기능 제한 시 라우터에서 수행)

**[R3 (Internal Router)에서의 요약 예시]**
지사(`192.170.x.x`)로 나가는 정보를 요약하거나, 지사에서 본사로 오는 정보를 요약합니다.

```bash
! -- R3 설정: 지사 대역(192.170.x.x)을 본사로 알릴 때 요약 --
! 가정: R3가 지사 대역을 Area 1로 받고, 본사를 Area 0으로 연결할 경우 (ABR 역할)
router ospf 1
 ! 192.170.0.0/16 전체를 하나의 경로로 광고
 area 1 range 192.170.0.0 255.255.0.0
 exit

```

---

## 3. 속도 및 품질 개선: QoS (Quality of Service)

회선 대역폭이 포화될 때, 업무에 중요한 트래픽(SSH 관리, Voice)이 유튜브 트래픽 등에 밀려 지연되는 것을 막습니다.

### 3.1 중요 트래픽 정의 (Class-Map)

**R1, R2 (Edge Router)**의 WAN 구간에 적용합니다.

```bash
R1(config)# class-map match-any CRITICAL_TRAFFIC
R1(config-cmap)# match protocol ssh
R1(config-cmap)# match protocol telnet
R1(config-cmap)# match protocol icmp
R1(config-cmap)# exit

R1(config)# class-map match-any BUSINESS_VOICE
R1(config-cmap)# match protocol rtp
R1(config-cmap)# exit

```

### 3.2 정책 수립 (Policy-Map)

음성 트래픽에 최우선 순위(Priority)를 주고, 관리 트래픽에 대역폭을 보장합니다.

```bash
R1(config)# policy-map WAN_QOS_POLICY
 ! 1. 음성 트래픽: 전체 대역폭의 20% 우선 할당 (지연 없음)
 R1(config-pmap)# class BUSINESS_VOICE
 R1(config-pmap-c)# priority percent 20
 R1(config-pmap-c)# exit
 
 ! 2. 관리 트래픽: 대역폭 10% 보장
 R1(config-pmap)# class CRITICAL_TRAFFIC
 R1(config-pmap-c)# bandwidth percent 10
 R1(config-pmap-c)# exit
 
 ! 3. 나머지 트래픽: 기본 처리 (Best Effort)
 R1(config-pmap)# class class-default
 R1(config-pmap-c)# fair-queue
 R1(config-pmap-c)# exit

```

### 3.3 인터페이스 적용

WAN 인터페이스(ISP 방향)의 Outbound(나가는 트래픽)에 적용합니다.

```bash
R1(config)# interface GigabitEthernet0/0
R1(config-if)# service-policy output WAN_QOS_POLICY
R1(config-if)# exit

```

*(R2에도 동일하게 적용)*

---

## 4. 사고 안전 대비: IP SLA & Tracking (지능형 장애 감지)

현재의 라우팅은 "포트가 켜져 있으면(Up)" 경로가 살아있다고 판단합니다. 하지만 ISP 내부 장애로 **"링크는 연결되어 있지만 인터넷이 안 되는(Blackhole)"** 상황을 감지하지 못합니다. **IP SLA**를 통해 실제 통신 가능 여부를 체크합니다.

### 4.1 IP SLA 설정 (ISP 구간 감시)

ISP 게이트웨이(111.111.111.1)로 5초마다 ICMP Echo(핑)를 보냅니다.

```bash
! -- R1 설정 --
R1(config)# ip sla 1
R1(config-ip-sla)# icmp-echo 111.111.111.1 source-interface GigabitEthernet0/0
R1(config-ip-sla-echo)# frequency 5
R1(config-ip-sla-echo)# exit

! -- SLA 스케줄 시작 --
R1(config)# ip sla schedule 1 life forever start-time now

! -- SLA 상태를 추적하는 Track 객체 생성 --
R1(config)# track 1 ip sla 1 reachability

```

### 4.2 라우팅 테이블 연동

Track 1번이 Down(핑 실패)되면, 해당 기본 경로(Default Route)를 라우팅 테이블에서 즉시 삭제하여 트래픽을 R2로 우회시킵니다.

```bash
! 기존 라우트 삭제 후 Track 적용
R1(config)# no ip route 0.0.0.0 0.0.0.0 111.111.111.1
R1(config)# ip route 0.0.0.0 0.0.0.0 111.111.111.1 track 1

```

---

## 5. 미래 전략 방안: IPv6 Dual Stack (Cloud & IoT Ready)

향후 AWS 서비스 및 IoT 장비 확장에 대비하여 IPv4와 IPv6를 동시에 사용하는 **Dual Stack** 환경을 Core 계층부터 단계적으로 도입합니다.

### 5.1 IPv6 활성화 및 주소 할당

**HQ Core Switch (MSW1)**에 IPv6 라우팅을 활성화합니다.

```bash
MSW1(config)# ipv6 unicast-routing

! -- VLAN 10 (임원/마케팅)에 IPv6 할당 --
MSW1(config)# interface Vlan10
MSW1(config-if)# ipv6 address 2001:DB8:HQ:10::1/64
MSW1(config-if)# ipv6 ospf 1 area 0
MSW1(config-if)# exit

! -- OSPFv3 (IPv6용 OSPF) 설정 --
MSW1(config)# ipv6 router ospf 1
MSW1(config-rtr)# router-id 1.1.1.1
MSW1(config-rtr)# exit

```

### 5.2 네트워크 자동화 준비 (NetDevOps)

미래의 운영 효율화를 위해 Python 스크립트 등이 장비에 접근하여 설정을 변경할 수 있도록 API 또는 보안 채널을 엽니다. (Cisco 장비 기준)

```bash
! -- NETCONF/RESTCONF 활성화 (지원 장비 가정) --
! R1(config)# netconf-yang
! R1(config)# restconf

! -- SNMPv3 설정 (모니터링 강화) --
R1(config)# snmp-server group ADMIN_GROUP v3 priv
R1(config)# snmp-server user admin ADMIN_GROUP v3 auth sha cisco123! priv aes 128 cisco123!

```

---

## 6. 결론: 최적화 프로젝트 기대 효과

본 최적화 작업을 통해 다음과 같은 개선 효과를 얻을 수 있습니다.

1. **안정성(Safety):** IP SLA 도입으로 ISP 측의 논리적 장애까지 감지하여 **100% 무중단 네트워크**에 근접했습니다.
2. **효율성(Performance):** QoS 정책을 통해 트래픽 폭주 시에도 음성 통화 및 중요 업무 시스템의 **응답 속도를 보장**합니다.
3. **확장성(Scalability):** 라우트 요약(Summarization)을 통해 장비의 CPU/메모리 부하를 줄여, 향후 지사가 100개 이상으로 늘어나도 견딜 수 있는 구조를 만들었습니다.
4. **미래 지향(Future-Proof):** IPv6 및 자동화 인터페이스를 미리 구성하여, 급변하는 클라우드 환경과 IoT 도입에 즉각 대응할 수 있습니다.

Next Level : AWS VPC 생성 및 Site-to-Site VPN 연결 설정
