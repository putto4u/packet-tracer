## 제26장: 엔터프라이즈 전 구간 이중화 네트워크 — ISP부터 서버까지의 통합 설계

본 장에서는 **ISP 이중화**, **경계 보안(HA)**, **백본 및 서버팜 이중화**가 모두 적용된 최상위 수준의 네트워크 아키텍처를 다룹니다. 모든 구간에 OSPF 동적 라우팅을 적용하여 장애 발생 시 1초 내외로 경로를 자동 복구하는 무중단 환경을 구축합니다.

---

### 1. 상세 구성 정보 및 IP 할당표 (Full IP Plan)

| 계층 | 장비명 | 인터페이스 | 연결 대상 | IP 주소 / 서브넷 | OSPF Area |
| --- | --- | --- | --- | --- | --- |
| **외부** | **ISP-1** | - | Router-A | 211.1.1.1/30 | - |
|  | **ISP-2** | - | Router-B | 212.1.1.1/30 | - |
| **경계** | **Router-A** | Gi0/0 / Gi0/1 | ISP-1 / FW-A | 211.1.1.2/30, 10.0.1.1/30 | Area 0 |
|  | **Router-B** | Gi0/0 / Gi0/1 | ISP-2 / FW-B | 212.1.1.2/30, 10.0.2.1/30 | Area 0 |
| **보안** | **FW-A (Act)** | Gi0/0 / Gi0/1 | Router-A / Core-A | 10.0.1.2/30, 172.16.1.1/30 | Area 0 |
|  | **FW-B (Stby)** | Gi0/0 / Gi0/1 | Router-B / Core-B | 10.0.2.2/30, 172.16.2.1/30 | Area 0 |
| **백본** | **Core-A** | Gi0/1 / Gi0/2 | FW-A / Farm-A | 172.16.1.2/30, 10.10.10.2/24 | Area 0, 10 |
|  | **Core-B** | Gi0/1 / Gi0/2 | FW-B / Farm-B | 172.16.2.2/30, 10.10.20.2/24 | Area 0, 10 |
| **서버팜** | **Farm-A** | VLAN 10 | Server 1, 2 | 10.10.10.1/24 (GW) | Area 10 |
|  | **Farm-B** | VLAN 20 | Server 3, 4 | 10.10.20.1/24 (GW) | Area 10 |

---

### 2. 장비별 OSPF 및 이중화 설정 (Full CLI)

#### ① Border Router (Router-A / B)

각 라우터는 ISP 회선의 우선순위를 결정합니다. Router-A를 메인으로 설정합니다.

```ios
# Router-A (Primary ISP)
hostname Router-A
interface Gi0/0
 ip address 211.1.1.2 255.255.255.252
 ip nat outside
interface Gi0/1
 ip address 10.0.1.1 255.255.255.252
 ip nat inside
router ospf 1
 router-id 1.1.1.1
 network 10.0.1.0 0.0.0.3 area 0
 default-information originate always metric 10  # 메인 경로 (낮은 Cost)

# Router-B (Secondary ISP)
hostname Router-B
interface Gi0/0
 ip address 212.1.1.2 255.255.255.252
 ip nat outside
interface Gi0/1
 ip address 10.0.2.1 255.255.255.252
 ip nat inside
router ospf 1
 router-id 1.1.1.2
 network 10.0.2.0 0.0.0.3 area 0
 default-information originate always metric 20  # 백업 경로 (높은 Cost)

```

#### ② Firewall HA (Active-Standby)

방화벽은 장애 시 세션을 유지하며 IP를 승계합니다.

```ios
# Firewall-A (Primary) 기준
hostname Firewall-A
interface Gi0/0 (Outside)
 nameif outside
 security-level 0
 ip address 10.0.1.2 255.255.255.252 standby 10.0.2.2
interface Gi0/1 (Inside)
 nameif inside
 security-level 100
 ip address 172.16.1.1 255.255.255.252 standby 172.16.2.1
router ospf 1
 network 10.0.1.0 255.255.255.252 area 0
 network 172.16.1.0 255.255.255.252 area 0

```

#### ③ Core Switch (Core-A / B)

백본 스위치는 상위 방화벽과 하위 서버팜 사이의 데이터 중계 및 경로 최적화를 담당합니다.

```ios
# Core-A 설정
hostname Core-A
ip routing
interface Gi0/1 (To FW)
 no switchport
 ip address 172.16.1.2 255.255.255.252
router ospf 1
 router-id 2.2.2.1
 network 172.16.1.0 0.0.0.3 area 0
 network 10.10.10.0 0.0.0.255 area 10

```

#### ④ Server Farm Switch (Farm-A / B)

서버들에게 직접 게이트웨이를 제공하며, 서버 쪽으로는 불필요한 OSPF 패킷을 보내지 않습니다.

```ios
# Farm-A 설정
hostname Farm-A
ip routing
interface Vlan 10
 ip address 10.10.10.1 255.255.255.0
router ospf 1
 router-id 10.10.10.10
 network 10.10.10.0 0.0.0.255 area 10
 passive-interface Vlan 10

```

---

### 3. 실무 검증 및 모니터링

1. **ISP 경로 확인:** 서버에서 `tracert 8.8.8.8` 실행 시 Router-A(`10.0.1.1`)를 거치는지 확인합니다.
2. **장애 시뮬레이션:** Router-A의 인터페이스를 `shutdown` 하고, 트래픽이 Router-B(`10.0.2.1`)로 자동으로 우회되는지 관찰합니다.
3. **HSRP/VRRP 확인:** 서버팜 계층에서 게이트웨이 이중화 상태를 `show standby brief`로 점검합니다.

---

### 4. 핵심 단어 요약

* **ISP Redundancy:** 다중 ISP를 통한 인터넷 연결성 확보.
* **Metric Manipulation:** OSPF Cost 조절을 통한 트래픽 경로 제어.
* **Active-Standby HA:** 장비 장애 시 즉시 서비스를 승계하는 고가용성 구성.
* **Area Border:** 서로 다른 OSPF 영역을 잇는 경계 지점의 라우팅 관리.

---

**Next: 네트워크 모니터링과 트래픽 분석(NetFlow) 실무**

ISP Redundancy, OSPF Cost, Firewall HA, Redundant Topology, IP Addressing.
