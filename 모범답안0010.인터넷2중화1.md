## AWS 하이브리드 클라우드 연동을 위한 최종 표준 네트워크 설계


<img width="1536" height="791" alt="image" src="https://github.com/user-attachments/assets/b9b96f0b-2c02-462a-b2bc-47941a2e3c66" />




업로드하신 이미지(`image_5f2424.png`)는 각 장비 간의 연결 구간을 독립된 서브넷으로 완벽히 분리하면서도, 3단계 계층 구조(Core-Distribution-Access)에 맞는 일관된 IP 규칙을 적용한 최적의 설계입니다. 이 구성은 향후 AWS Site-to-Site VPN을 통해 온프레미스와 클라우드를 연결할 때 라우팅 경로를 가장 명확하게 제어할 수 있는 구조입니다.



## 1. 네트워크 주소 할당표 (최종본 반영)

내부 사용자 망은 대중적인 사설 대역인 `192.168.10.x`를 사용하고, 장비 간 연결 구간은 AWS VPC(일반적으로 `10.x.x.x` 사용)와 중복되지 않도록 `172.16.x.x` 대역을 엄격히 분리하여 할당했습니다.

| 구분 | 장비 및 인터페이스 | IP 주소 / Subnet | 연결 대상 및 목적 |
| --- | --- | --- | --- |
| **외부 연동** | Router0 Gi0/0 | **111.111.111.2/30** | ISP 1 (Primary Public Link) |
|  | Router1 Gi0/0 | **222.222.222.2/30** | ISP 2 (Secondary Public Link) |
| **백본 연결** | Router0 ↔ SW0 | 172.16.1.1 ↔ 1.2 /24 | 내부 라우팅 경로 A |
|  | Router0 ↔ SW1 | 172.16.4.1 ↔ 4.2 /24 | 내부 라우팅 경로 B |
|  | Router1 ↔ SW0 | 172.16.3.1 ↔ 3.2 /24 | 내부 라우팅 경로 C |
|  | Router1 ↔ SW1 | 172.16.2.1 ↔ 2.2 /24 | 내부 라우팅 경로 D |
| **사용자 망** | **Vlan 10 가상 GW** | **192.168.10.1/24** | **HSRP 가상 게이트웨이 IP** |
|  | SW0 Vlan 10 | 192.168.10.2/24 | SW0용 인터페이스 IP |
|  | SW1 Vlan 10 | 192.168.10.2/24 | SW1용 인터페이스 IP (이미지 기준 동일 할당) |

---

## 2. 장비별 최종 CLI 설정 파일

### Router0 (ISP 1 - 111.111.111.2)

백본에 2개 라우터를 붙여 인터넷 이중화 한 자주 쓰이는 사례 중 하나에요.
두 라우터 아래 스위치를 넣고 DMZ 구간을 만드는 사례도 많습니다. 

```bash
hostname Router0
!
interface GigabitEthernet0/0
 description OUTSIDE_ISP1
 ip address 111.111.111.2 255.255.255.252
 ip nat outside
!
interface GigabitEthernet0/1
 ip address 172.16.1.1 255.255.255.0
 ip nat inside
!
interface GigabitEthernet0/2
 ip address 172.16.4.1 255.255.255.0
 ip nat inside
!
!현장에서 로드밸런스 보다 OSPF 프로토콜로 단순화 해요.
!하지만 네트워크가 많아지면 에어리어수가 많아지고 오버헤드(버거워지는)가 커지는 단점이 있어요.
router ospf 1
 network 172.16.1.0 0.0.0.255 area 0
 network 172.16.4.0 0.0.0.255 area 0
 default-information originate
!
ip route 0.0.0.0 0.0.0.0 111.111.111.1
ip nat inside source list 1 interface GigabitEthernet0/0 overload
! overload는 헤더에 port를 오버로드해서 매핑테이블을 만들겠다는 의미로 제일 중요해요.
access-list 1 permit 192.168.10.0 0.0.0.255

```

### Router1 (ISP 2 - 222.222.222.2)

```bash
hostname Router1
!
interface GigabitEthernet0/0
 description OUTSIDE_ISP2
 ip address 222.222.222.2 255.255.255.252
 ip nat outside
!
interface GigabitEthernet0/1
 ip address 172.16.3.1 255.255.255.0
 ip nat inside
!
interface GigabitEthernet0/2
 ip address 172.16.2.1 255.255.255.0
 ip nat inside
!
router ospf 1
 network 172.16.3.0 0.0.0.255 area 0
 network 172.16.2.0 0.0.0.255 area 0
 default-information originate
!
ip route 0.0.0.0 0.0.0.0 222.222.222.1
ip nat inside source list 1 interface GigabitEthernet0/0 overload
access-list 1 permit 192.168.10.0 0.0.0.255

```

### Multilayer Switch 0 (Vlan 10 Active)

```bash
hostname SW0
!
ip routing
!
interface GigabitEthernet0/1
 no switchport
 ip address 172.16.1.2 255.255.255.0
!
interface GigabitEthernet0/2
 no switchport
 ip address 172.16.3.2 255.255.255.0
!
interface Vlan 10
 ip address 192.168.10.2 255.255.255.0
 standby 10 ip 192.168.10.1
 standby 10 priority 110
 standby 10 preempt
!
router ospf 1
 network 172.16.1.0 0.0.0.255 area 0
 network 172.16.3.0 0.0.0.255 area 0
 network 192.168.10.0 0.0.0.255 area 0

```

### Multilayer Switch 1 (Vlan 10 Standby)

```bash
hostname SW1
!
ip routing
!
interface GigabitEthernet0/1
 no switchport
 ip address 172.16.4.2 255.255.255.0
!
interface GigabitEthernet0/2
 no switchport
 ip address 172.16.2.2 255.255.255.0
!
interface Vlan 10
 ip address 192.168.10.2 255.255.255.0
 standby 10 ip 192.168.10.1
 standby 10 priority 100
 standby 10 preempt
!
router ospf 1
 network 172.16.4.0 0.0.0.255 area 0
 network 172.16.2.0 0.0.0.255 area 0
 network 192.168.10.0 0.0.0.255 area 0

```

---

## 3. 로드밸런싱 및 이중화 동작 분석

1. **동적 로드밸런싱 (ECMP)**: `SW0`과 `SW1`은 OSPF를 통해 외부로 나가는 경로를 2개씩 보유합니다. 패킷은 목적지에 따라 두 ISP 라우터로 분산되어 전송됩니다.
2. **VLAN 게이트웨이 이중화 (HSRP)**: 하단 PC들은 게이트웨이를 `192.168.10.1`로 설정합니다. 평시에는 `SW0`이 모든 트래픽을 처리하며, 장애 시 `SW1`이 약 3초 이내에 역할을 인계받아 통신 중단을 최소화합니다.
3. **AWS 하이브리드 연동 최적화**: 내부 대역(`192.168.10.x`)과 백본 대역(`172.16.x.x`)이 AWS 기본 VPC 대역(`10.x.x.x`)과 완벽히 격리되어 있어, VPN 터널 생성 시 라우팅 충돌 없이 즉시 연동 가능합니다.

> **[과금 주의]** > * AWS와 연동할 경우, **Site-to-Site VPN** 터널 당 시간당 요금(약 **$0.05**)이 발생합니다.
> * 본 구성처럼 라우터 2대를 모두 연결할 경우 비용이 2배로 발생하므로, 비용 최적화가 필요하다면 한 쪽 터널만 상시 가동하는 정책을 고려하십시오.
> 
> 

---

Next Level : AWS Site-to-Site VPN Customer Gateway 및 터널 인터페이스 설정

OSPF ECMP, HSRP Active/Standby, NAT Overload, 24bit IP 설계 준수
