# Chapter 6. Comprehensive Network Hardening (Device & L2/L3 Security)

## 1. 개요 및 보안 강화 전략 (Overview)

본 챕터에서는 ACL(접근 제어 목록) 외에 네트워크 인프라의 전반적인 보안 수준을 높이기 위해 **장비 자체의 보안(Device Hardening)**, **L2 스위칭 보안**, 그리고 **라우팅 프로토콜 보안**을 적용합니다. 이는 **심층 방어(Defense-in-Depth)** 전략의 핵심 요소로, 외부의 공격뿐만 아니라 내부자 위협 및 구성 오류로 인한 사고를 예방합니다.

### 1.1 주요 적용 기술

1. **Management Plane Protection:** Telnet 비활성화, SSH 적용, 패스워드 암호화, 유휴 시간 제한.
2. **L2 Security (Switching):**
* **Port Security:** 비인가 디바이스 접속 및 MAC Flooding 공격 방지.
* **DHCP Snooping:** 불법 DHCP 서버(Rogue DHCP)에 의한 MITM 공격 방지.
* **Unused Ports Shutdown:** 사용하지 않는 포트 비활성화.


3. **Control Plane Protection:** OSPF 라우팅 정보 인증(Authentication)을 통한 라우팅 테이블 변조 방지.

---

## 2. Management Plane: 장비 자체 보안 설정 (Device Hardening)

모든 라우터(R1~R4)와 스위치(MSW, Access SW)에 공통적으로 적용해야 하는 필수 보안 설정입니다.

### 2.1 계정 보안 및 SSH 활성화

평문 전송인 Telnet을 차단하고 암호화된 SSH만 허용하며, 비밀번호를 암호화하여 저장합니다.

**[모든 장비 공통 설정 Script]**

```bash
! 1. 비밀번호 암호화 서비스 활성화
service password-encryption

! 2. 강력한 Enable 비밀번호 설정 (MD5 해시)
enable secret cisco123!

! 3. 도메인 네임 설정 (SSH 키 생성 필수 조건)
ip domain-name mycompany.com

! 4. 관리자 계정 생성
username admin privilege 15 secret adminPass1!

! 5. SSH 암호화 키 생성 (1024비트 이상 권장)
crypto key generate rsa modulus 2048

! 6. SSH 버전 2 강제 및 접속 설정
ip ssh version 2
line vty 0 4
 login local
 transport input ssh
 exec-timeout 5 0  ! 5분간 입력 없으면 자동 로그아웃
 exit

```

### 2.2 불필요한 서비스 비활성화

장비의 리소스를 보호하고 공격 표면을 줄입니다.

```bash
! 웹 관리 콘솔 비활성화 (취약점 다수 존재)
no ip http server
no ip http secure-server

! DNS Lookup 비활성화 (오타 시 지연 방지 및 불필요한 트래픽 방지)
no ip domain-lookup

```

---

## 3. Data Plane (L2): 스위칭 보안 (Switch Hardening)

내부망 공격(ARP Spoofing, DHCP Spoofing 등)은 방화벽으로 막을 수 없으므로 스위치 레벨에서 차단해야 합니다.

### 3.1 Port Security (MAC 주소 제한)

액세스 스위치의 사용자 포트에 허용된 단말(MAC 주소) 개수를 제한하여 MAC Flooding 공격을 차단합니다.

**[HQ_Access_User 스위치 예시]**

```bash
! 사용자 PC가 연결된 포트 범위 지정
interface range FastEthernet0/1 - 20
 switchport mode access
 
 ! 포트 보안 활성화
 switchport port-security
 
 ! 포트당 최대 MAC 주소 2개 허용 (PC + IP Phone 고려)
 switchport port-security maximum 2
 
 ! 위반 시 포트 셧다운 대신 로그 남기고 패킷 드랍 (Restrict 모드)
 switchport port-security violation restrict
 
 ! MAC 주소를 동적으로 학습하여 고정 (Sticky)
 switchport port-security mac-address sticky
 exit

```

### 3.2 DHCP Snooping (신뢰할 수 없는 DHCP 차단)

사용자가 공유기를 잘못 연결하거나 해커가 가짜 DHCP 서버를 띄워 트래픽을 가로채는 것을 방지합니다. **Uplink(Trunk) 포트는 Trust, 사용자 포트는 Untrust(기본값)**로 설정합니다.

**[HQ_Access_User 스위치 예시]**

```bash
! 1. DHCP Snooping 전역 활성화
ip dhcp snooping

! 2. 대상 VLAN 지정
ip dhcp snooping vlan 10,30,40,50

! 3. Uplink (Core 연결 포트)를 신뢰(Trust) 포트로 설정
interface range GigabitEthernet0/1 - 2
 ip dhcp snooping trust
 exit

! 4. (참고) 사용자 포트는 기본적으로 Untrust이므로 별도 설정 불필요
! Untrust 포트에서 들어오는 DHCP Offer 패킷은 즉시 차단됨

```

### 3.3 Unused Port Shutdown (미사용 포트 잠금)

사용하지 않는 포트는 물리적으로 비활성화하고, 예비 VLAN(예: 999)에 할당하여 무단 연결을 방지합니다.

```bash
! 미사용 포트 범위 (예: 21번부터 24번)
interface range FastEthernet0/21 - 24
 description Unused_Ports
 switchport mode access
 switchport access vlan 999 ! 존재하지 않거나 Dummy VLAN
 shutdown
 exit

```

---

## 4. Control Plane: 라우팅 프로토콜 보안

공격자가 라우터에 접속하여 잘못된 라우팅 정보를 주입(Route Poisoning)하는 것을 막기 위해 OSPF 인증을 적용합니다.

### 4.1 OSPF MD5 Authentication

모든 OSPF 인접 장비(Neighbor) 간에 동일한 비밀번호(Key)를 공유하여 인증된 정보만 받아들입니다.

**[R1 (Edge Router) 설정 예시]**

```bash
interface GigabitEthernet0/1
 ! OSPF 메시지 인증 활성화 (Message-Digest)
 ip ospf message-digest-key 1 md5 OSPF_SECRET_KEY
 exit

interface GigabitEthernet0/2
 ip ospf message-digest-key 1 md5 OSPF_SECRET_KEY
 exit

router ospf 1
 ! Area 0 전체에 대해 MD5 인증 강제
 area 0 authentication message-digest
 exit

```

*(참고: R2, MSW1, MSW2, R3, R4 등 OSPF를 사용하는 모든 인터페이스와 라우터 프로세스에 동일하게 적용해야 Neighbor가 맺어집니다.)*

---

## 5. 최종 프로젝트 보고서 요약 (Security Section Summary)

### 5.1 보안 아키텍처 요약

본 프로젝트는 **'경계 방어(Perimeter Defense)'**를 넘어선 **'심층 방어(Defense-in-Depth)'** 아키텍처를 구현하였습니다.

1. **관리적 보안:** SSHv2 및 AAA(Local) 구성을 통해 장비 접근 권한을 강화하고 관리 트래픽을 암호화함.
2. **물리/링크 계층 보안:** Port Security를 통해 비인가 디바이스의 네트워크 접속을 물리 포트 단계에서 차단함.
3. **내부 위협 방어:** DHCP Snooping을 적용하여 내부망에서의 Man-in-the-Middle 공격 및 IP 충돌 사고를 원천 차단함.
4. **라우팅 무결성:** OSPF MD5 인증을 통해 라우팅 테이블의 무결성을 보장하고 라우팅 공격을 방어함.
5. **접근 제어:** 앞서 구현한 ACL을 통해 부서 간/서버 간 트래픽을 최소 권한 원칙(Principle of Least Privilege)에 따라 엄격히 통제함.

이러한 보안 설정은 AWS 하이브리드 클라우드 연동 시, 온프레미스 네트워크가 공격의 경유지로 악용되거나 클라우드 자원으로 위협이 확산되는 것을 방지하는 필수적인 조치입니다.

Next Level : AWS VPC 생성 및 Site-to-Site VPN 연결 설정
